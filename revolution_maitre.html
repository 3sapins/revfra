<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J'ai v√©cu la R√©volution - Ma√Ætre du jeu</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=EB+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root { --bleu-roi: #002654; --blanc-royal: #f5f0e6; --rouge-sang: #a41c1c; --or-ancien: #c9a227; --parchemin: #f4edd3; --encre: #1a1a1a; --sepia: #704214; --vert-laurier: #2d5a3d; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; overflow: hidden; }
        body { background: var(--parchemin); font-family: 'EB Garamond', Georgia, serif; color: var(--encre); }
        
        /* Header compact */
        .header { background: linear-gradient(180deg, var(--bleu-roi) 0%, #001a3d 100%); color: var(--blanc-royal); padding: 0.5rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .header-left { display: flex; align-items: center; gap: 1.5rem; }
        .header-title { font-family: 'Cinzel', serif; font-size: 1.2rem; font-weight: 700; }
        .header-progress { font-size: 0.9rem; opacity: 0.8; }
        .header-right { display: flex; align-items: center; gap: 1.5rem; }
        .game-code { background: var(--or-ancien); color: var(--encre); padding: 0.3rem 0.8rem; font-family: 'Cinzel', serif; font-weight: 900; font-size: 1.1rem; letter-spacing: 2px; }
        .responses-info { font-family: 'Cinzel', serif; font-size: 1rem; }
        .responses-info .count { color: var(--or-ancien); font-weight: 700; }
        
        /* √âcran situation - plein √©cran */
        .situation-screen { height: calc(100vh - 50px); display: flex; flex-direction: column; padding: 2rem 4rem; }
        .situation-header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .situation-year { font-family: 'Cinzel', serif; font-size: 4rem; font-weight: 900; color: var(--bleu-roi); }
        .situation-acte { font-family: 'Cinzel', serif; font-size: 1rem; color: var(--sepia); text-transform: uppercase; letter-spacing: 2px; }
        .situation-icon { font-size: 4rem; }
        
        .situation-title { font-family: 'Cinzel', serif; font-size: 2.2rem; color: var(--bleu-roi); margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 3px solid var(--or-ancien); }
        
        .situation-content { flex: 1; display: flex; gap: 3rem; overflow: hidden; }
        .situation-text-col { flex: 1.2; overflow-y: auto; padding-right: 1rem; }
        .situation-text { font-size: 1.4rem; line-height: 2; }
        .situation-text .term { color: var(--rouge-sang); font-style: italic; }
        
        .situation-choices-col { flex: 1; display: flex; flex-direction: column; }
        .situation-question { font-family: 'Cinzel', serif; font-size: 1.4rem; color: var(--sepia); margin-bottom: 1.5rem; font-weight: 700; }
        .choices-list { display: flex; flex-direction: column; gap: 1rem; }
        .choice-item { background: var(--blanc-royal); border: 2px solid var(--sepia); padding: 1rem 1.5rem; display: flex; align-items: flex-start; gap: 1rem; font-size: 1.2rem; }
        .choice-letter { background: var(--bleu-roi); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Cinzel', serif; font-weight: 700; flex-shrink: 0; }
        
        /* √âcran classements - plein √©cran */
        .rankings-screen { height: calc(100vh - 50px); display: none; padding: 2rem 4rem; }
        .rankings-screen.active { display: flex; flex-direction: column; }
        .rankings-title { font-family: 'Cinzel', serif; font-size: 2rem; text-align: center; color: var(--bleu-roi); margin-bottom: 2rem; }
        .rankings-grid { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }
        .ranking-card { background: var(--blanc-royal); border: 4px solid; padding: 1.5rem; display: flex; flex-direction: column; }
        .ranking-card.lumieres { border-color: #ffd700; }
        .ranking-card.histoire { border-color: #4a90d9; }
        .ranking-card.ancien { border-color: #a0a0a0; }
        .ranking-header { display: flex; align-items: center; justify-content: center; gap: 0.8rem; margin-bottom: 1rem; padding-bottom: 0.8rem; border-bottom: 2px solid currentColor; }
        .ranking-card.lumieres .ranking-header { color: #b8860b; }
        .ranking-card.histoire .ranking-header { color: #2e6da4; }
        .ranking-card.ancien .ranking-header { color: #666; }
        .ranking-icon { font-size: 2rem; }
        .ranking-title { font-family: 'Cinzel', serif; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
        .ranking-list { list-style: none; flex: 1; overflow-y: auto; }
        .ranking-item { display: flex; align-items: center; gap: 1rem; padding: 0.6rem 0; border-bottom: 1px solid rgba(0,0,0,0.1); font-size: 1.2rem; }
        .ranking-position { font-family: 'Cinzel', serif; font-weight: 900; font-size: 1.4rem; width: 35px; text-align: center; }
        .ranking-item:nth-child(1) .ranking-position { color: #ffd700; }
        .ranking-item:nth-child(2) .ranking-position { color: #c0c0c0; }
        .ranking-item:nth-child(3) .ranking-position { color: #cd7f32; }
        .ranking-name { flex: 1; }
        .ranking-score { font-family: 'Cinzel', serif; font-weight: 700; color: var(--sepia); }
        
        .btn-next { position: fixed; bottom: 2rem; right: 2rem; padding: 1rem 2rem; font-family: 'Cinzel', serif; font-size: 1.1rem; font-weight: 700; text-transform: uppercase; background: linear-gradient(180deg, var(--rouge-sang) 0%, #7a1515 100%); color: white; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn-next:disabled { background: #999; cursor: not-allowed; }
        
        /* Setup screen */
        .setup-screen { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--encre) 0%, #1a1a2e 100%); }
        .setup-card { background: var(--blanc-royal); color: var(--encre); border: 4px solid var(--sepia); padding: 3rem; max-width: 550px; width: 100%; text-align: center; }
        .setup-title { font-family: 'Cinzel', serif; font-size: 1.8rem; color: var(--bleu-roi); margin-bottom: 0.5rem; }
        .setup-subtitle { font-size: 1.2rem; color: var(--rouge-sang); margin-bottom: 2rem; font-style: italic; }
        .qr-container { background: white; padding: 1rem; display: inline-block; margin: 1rem 0; border: 2px solid var(--sepia); }
        .join-url { font-family: monospace; font-size: 0.85rem; background: var(--parchemin); padding: 0.5rem; border: 1px solid var(--sepia); margin: 1rem 0; word-break: break-all; }
        .waiting-text { font-size: 1.1rem; color: var(--sepia); margin: 1rem 0; }
        .players-waiting { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin: 1rem 0; }
        .player-chip { background: var(--bleu-roi); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem; }
        .btn { padding: 0.8rem 2rem; font-family: 'Cinzel', serif; font-size: 1rem; font-weight: 700; text-transform: uppercase; border: none; cursor: pointer; }
        .btn-gold { background: linear-gradient(180deg, var(--or-ancien) 0%, #a68521 100%); color: var(--encre); }
        .btn:disabled { background: #999; cursor: not-allowed; }
        
        /* End screen */
        .end-screen { display: none; height: 100vh; background: linear-gradient(135deg, var(--encre) 0%, #1a1a2e 100%); color: var(--blanc-royal); padding: 2rem; overflow-y: auto; }
        .end-screen.active { display: block; }
        .end-title { font-family: 'Cinzel', serif; font-size: 2.5rem; text-align: center; color: var(--or-ancien); margin-bottom: 2rem; }
        .final-rankings { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; max-width: 1200px; margin: 0 auto 2rem; }
        .final-ranking-card { background: rgba(255,255,255,0.05); border: 3px solid; padding: 1.5rem; }
        .final-ranking-card.lumieres { border-color: #ffd700; }
        .final-ranking-card.histoire { border-color: #4a90d9; }
        .final-ranking-card.ancien { border-color: #c0c0c0; }
        .podium { display: flex; justify-content: center; align-items: flex-end; gap: 0.5rem; margin: 1rem 0; }
        .podium-place { text-align: center; padding: 0.8rem; min-width: 100px; }
        .podium-place.first { background: linear-gradient(180deg, #ffd700, #b8860b); color: var(--encre); padding-bottom: 3rem; }
        .podium-place.second { background: linear-gradient(180deg, #c0c0c0, #808080); color: var(--encre); padding-bottom: 2rem; }
        .podium-place.third { background: linear-gradient(180deg, #cd7f32, #8b4513); color: white; padding-bottom: 1.5rem; }
        .podium-name { font-family: 'Cinzel', serif; font-weight: 700; }
        .podium-score { font-size: 0.85rem; opacity: 0.8; }
        .class-stats { background: rgba(255,255,255,0.05); border: 2px solid var(--or-ancien); padding: 1.5rem; max-width: 1200px; margin: 0 auto; }
        .stats-title { font-family: 'Cinzel', serif; font-size: 1.5rem; color: var(--or-ancien); margin-bottom: 1rem; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .stat-item { text-align: center; padding: 1rem; background: rgba(255,255,255,0.05); }
        .stat-value { font-family: 'Cinzel', serif; font-size: 2rem; font-weight: 900; color: var(--or-ancien); }
        .stat-label { font-size: 0.9rem; opacity: 0.8; }
        
        .hidden { display: none !important; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .pulse { animation: pulse 1.5s ease infinite; }
    </style>
</head>
<body>
    <!-- Setup Screen -->
    <div class="setup-screen" id="setupScreen">
        <div class="setup-card">
            <h1 class="setup-title">üèõÔ∏è J'ai v√©cu la R√©volution</h1>
            <p class="setup-subtitle">Mode Ma√Ætre du Jeu</p>
            <div id="createSection">
                <p style="margin-bottom: 1.5rem;">Cr√©ez une partie et partagez le code avec vos √©l√®ves.</p>
                <button class="btn btn-gold" id="createGameBtn">Cr√©er une partie</button>
            </div>
            <div id="waitingSection" class="hidden">
                <div class="qr-container"><div id="qrCode"></div></div>
                <div class="game-code" style="font-size: 2.5rem; letter-spacing: 8px; margin: 1rem 0;" id="displayCode">XXXX</div>
                <div class="join-url" id="joinUrl">URL</div>
                <p class="waiting-text pulse">En attente des joueurs...</p>
                <div class="players-waiting" id="playersWaiting"></div>
                <button class="btn btn-gold" id="startGameBtn" disabled style="margin-top: 1rem;">Lancer (<span id="playerCountSetup">0</span> joueurs)</button>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="game-screen hidden" id="gameScreen">
        <header class="header">
            <div class="header-left">
                <div class="header-title">üèõÔ∏è J'ai v√©cu la R√©volution</div>
                <div class="header-progress">Situation <span id="currentNum">1</span> / <span id="totalNum">29</span></div>
            </div>
            <div class="header-right">
                <div class="responses-info">R√©ponses : <span class="count" id="responsesCount">0</span>/<span id="totalPlayers">0</span></div>
                <div class="game-code" id="headerCode">XXXX</div>
            </div>
        </header>
        
        <!-- Situation Display -->
        <div class="situation-screen" id="situationScreen">
            <div class="situation-header-bar">
                <div>
                    <div class="situation-year" id="situationYear">1789</div>
                    <div class="situation-acte" id="situationActe">Acte I ‚Ä¢ 1788-1789</div>
                </div>
                <div class="situation-icon" id="situationIcon">üìú</div>
            </div>
            <h2 class="situation-title" id="situationTitle">Titre</h2>
            <div class="situation-content">
                <div class="situation-text-col">
                    <div class="situation-text" id="situationText"></div>
                </div>
                <div class="situation-choices-col">
                    <p class="situation-question" id="situationQuestion"></p>
                    <div class="choices-list" id="choicesList"></div>
                </div>
            </div>
        </div>
        
        <!-- Rankings Display -->
        <div class="rankings-screen" id="rankingsScreen">
            <h2 class="rankings-title">üìä Classements apr√®s cette situation</h2>
            <div class="rankings-grid">
                <div class="ranking-card lumieres">
                    <div class="ranking-header"><span class="ranking-icon">üèõÔ∏è</span><span class="ranking-title">Penseurs des Lumi√®res</span></div>
                    <ol class="ranking-list" id="rankingLumieres"></ol>
                </div>
                <div class="ranking-card histoire">
                    <div class="ranking-header"><span class="ranking-icon">üìú</span><span class="ranking-title">Acteurs de l'Histoire</span></div>
                    <ol class="ranking-list" id="rankingHistoire"></ol>
                </div>
                <div class="ranking-card ancien">
                    <div class="ranking-header"><span class="ranking-icon">üëë</span><span class="ranking-title">D√©fenseurs Ancien R√©gime</span></div>
                    <ol class="ranking-list" id="rankingAncien"></ol>
                </div>
            </div>
        </div>
        
        <button class="btn-next" id="nextBtn">Suivant ‚Üí</button>
    </div>
    
    <!-- End Screen -->
    <div class="end-screen" id="endScreen"></div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const firebaseConfig = {
    apiKey: "AIzaSyD13KgzVLlclck2HEsBF8cQp-x1tm18CSc",
    authDomain: "revolution-7714f.firebaseapp.com",
    databaseURL: "https://revolution-7714f-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "revolution-7714f"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let gameCode = '', gameRef = null, currentSituation = 0, players = {}, showingRankings = false;

const definitions = {"√âtats g√©n√©raux":"Assembl√©e des trois ordres pour conseiller le roi","cahier de dol√©ances":"Document listant les plaintes du peuple","Assembl√©e nationale":"Nom pris par le Tiers-√âtat le 17 juin 1789","Constitution":"Texte d√©finissant les r√®gles du pouvoir","Bastille":"Prison symbole de l'arbitraire royal","Grande Peur":"Panique dans les campagnes, √©t√© 1789","biens nationaux":"Propri√©t√©s confisqu√©es √† l'√âglise","sans-culottes":"R√©volutionnaires parisiens du peuple","Terreur":"P√©riode de r√©pression 1793-1794","guillotine":"Machine √† d√©capiter","Thermidor":"Chute de Robespierre","Directoire":"R√©gime 1795-1799","18 Brumaire":"Coup d'√âtat de Bonaparte","Consulat":"R√©gime dirig√© par Bonaparte","Concordat":"Accord avec le pape (1801)","blocus continental":"Interdiction de commerce avec l'Angleterre","Waterloo":"D√©faite finale de Napol√©on","Sainte-H√©l√®ne":"√éle d'exil de Napol√©on"};
const actes = [{id:1,nom:"La fin de l'Ancien R√©gime",periode:"1788-1789"},{id:2,nom:"La monarchie constitutionnelle",periode:"1789-1792"},{id:3,nom:"La R√©publique et la Terreur",periode:"1792-1794"},{id:4,nom:"La R√©publique bourgeoise",periode:"1794-1799"},{id:5,nom:"Le Consulat et l'Empire",periode:"1799-1815"},{id:6,nom:"√âpilogue",periode:"1814-1821"}];

const situations = [
{id:1,acte:1,year:1789,title:"Les cahiers de dol√©ances",icon:"üìú",text:"L'hiver 1788 a √©t√© terrible : le gel a d√©truit les r√©coltes, le prix du pain a doubl√©. La France est au bord de la faillite.\n\nFace √† la crise, Louis XVI convoque les <em>√âtats g√©n√©raux</em> ‚Äî une assembl√©e des trois ordres (Clerg√©, Noblesse, Tiers-√âtat) qui ne s'est pas r√©unie depuis 175 ans !\n\nChaque communaut√© doit r√©diger un <em>cahier de dol√©ances</em> pour exprimer ses plaintes et ses souhaits de r√©formes. Dans ton village, l'assembl√©e se r√©unit √† l'√©glise. C'est ton tour de parler.",question:"Que dis-tu devant l'assembl√©e ?",savoirPlus:"<h4>Les √âtats g√©n√©raux</h4><p>Derni√®re r√©union : 1614 ! Le Tiers-√âtat repr√©sente 98% de la population mais n'a qu'une voix sur trois.</p>",choices:[{text:"Le roi est bon, mais ses ministres l'ont mal conseill√©. Faisons-lui confiance.",scores:{lumieres:0,histoire:1,ancien:2}},{text:"Abolissons les privil√®ges ! Nous voulons l'√©galit√© devant l'imp√¥t !",scores:{lumieres:2,histoire:2,ancien:0}},{text:"Les cahiers ne servent √† rien ! Il faut prendre les armes !",scores:{lumieres:1,histoire:0,ancien:0}},{text:"Je me propose comme d√©l√©gu√© pour porter nos dol√©ances √† Versailles.",scores:{lumieres:1,histoire:1,ancien:1}}]},
{id:2,acte:1,year:1789,title:"Le Serment du Jeu de Paume",icon:"‚úä",text:"Les √âtats g√©n√©raux s'ouvrent √† Versailles le 5 mai 1789. Tr√®s vite, un conflit √©clate : comment voter ? Par ordre (ce qui avantage Clerg√© et Noblesse) ou par t√™te ?\n\nLe 17 juin, le Tiers-√âtat se proclame <em>Assembl√©e nationale</em>. Le 20 juin, trouvant leur salle ferm√©e, les d√©put√©s se r√©unissent dans une salle de Jeu de Paume et jurent de ne jamais se s√©parer avant d'avoir donn√© une <em>Constitution</em> √† la France.",question:"Comment r√©agis-tu √† cette nouvelle extraordinaire ?",savoirPlus:"<h4>Le Jeu de Paume</h4><p>C'√©tait l'anc√™tre du tennis ! 577 d√©put√©s y ont pr√™t√© serment. Un seul a refus√©.</p>",choices:[{text:"Ces d√©put√©s sont des rebelles qui insultent le roi !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Quel courage ! Enfin des hommes qui osent d√©fier l'arbitraire !",scores:{lumieres:2,histoire:2,ancien:0}},{text:"Ce n'est qu'un d√©but ! Il faut abolir compl√®tement la monarchie !",scores:{lumieres:1,histoire:0,ancien:0}},{text:"Attendons de voir comment le roi va r√©agir...",scores:{lumieres:0,histoire:1,ancien:1}}]},
{id:3,acte:1,year:1789,title:"La prise de la Bastille",icon:"üè∞",text:"Paris, 14 juillet 1789. Le roi a mass√© 20 000 soldats autour de la capitale et renvoy√© le ministre Necker, populaire aupr√®s du peuple.\n\nLa foule parisienne s'arme et marche sur la <em>Bastille</em>, forteresse m√©di√©vale servant de prison royale. Apr√®s 4 heures de combat, la forteresse tombe. Le gouverneur de Launay est massacr√©, sa t√™te promen√©e au bout d'une pique.\n\nOn distribue des cocardes tricolores : bleu et rouge (Paris), blanc (le roi).",question:"Comment r√©agis-tu √† ces √©v√©nements ?",savoirPlus:"<h4>La Bastille</h4><p>Elle ne contenait que 7 prisonniers ce jour-l√† ! Mais elle symbolisait l'arbitraire royal : le roi pouvait y enfermer n'importe qui sans proc√®s.</p>",choices:[{text:"Une t√™te au bout d'une pique ! Ces gens sont des sauvages !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"La Bastille est tomb√©e ! La libert√© est en marche !",scores:{lumieres:2,histoire:2,ancien:0}},{text:"Faisons pareil avec tous les ch√¢teaux de France !",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Mettons cette cocarde tricolore pour √©viter les ennuis...",scores:{lumieres:0,histoire:1,ancien:1}}]},
{id:4,acte:1,year:1789,title:"La nuit du 4 ao√ªt",icon:"üî•",text:"La <em>Grande Peur</em> secoue les campagnes. Des rumeurs de \"brigands\" poussent les paysans √† s'armer. Ils en profitent pour attaquer les ch√¢teaux et br√ªler les archives seigneuriales.\n\n√Ä l'Assembl√©e, dans la nuit du 4 ao√ªt, nobles et clercs renoncent √† leurs privil√®ges dans un √©lan d'enthousiasme (sinc√®re ou calcul√© ?). C'est la fin de la soci√©t√© d'ordres vieille de mille ans !",question:"Que penses-tu de ces √©v√©nements ?",savoirPlus:"<h4>Ce qui a √©t√© aboli</h4><ul><li>Droits seigneuriaux</li><li>D√Æme de l'√âglise</li><li>Privil√®ges fiscaux</li><li>Justice seigneuriale</li></ul>",choices:[{text:"Ces paysans sont des voleurs ! Le seigneur avait des droits l√©gitimes !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"L'Assembl√©e a eu raison d'abolir ces privil√®ges injustes.",scores:{lumieres:2,histoire:2,ancien:0}},{text:"Maintenant, il faut aussi partager les terres des nobles !",scores:{lumieres:1,histoire:0,ancien:0}},{text:"Je me renseigne pour acheter des terres √† bas prix...",scores:{lumieres:0,histoire:1,ancien:0}}]},
{id:5,acte:1,year:1789,title:"La D√©claration des Droits de l'Homme",icon:"üìã",text:"Le 26 ao√ªt 1789, l'Assembl√©e adopte la D√©claration des Droits de l'Homme et du Citoyen :\n\n\"Les hommes naissent et demeurent libres et √©gaux en droits.\"\n\nCe texte proclame la libert√© d'expression, la pr√©somption d'innocence, le droit de propri√©t√©. Il inspirera le monde entier.",question:"Qu'en penses-tu ?",savoirPlus:"<h4>Les limites</h4><p>Les femmes sont exclues. L'esclavage est maintenu dans les colonies. Seuls les hommes riches pourront voter.</p>",choices:[{text:"Texte impie ! Dieu a voulu qu'il y ait des nobles et des paysans !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Magnifique ! Libert√©, √©galit√©... les fondements d'une soci√©t√© juste !",scores:{lumieres:2,histoire:2,ancien:0}},{text:"√áa ne va pas assez loin ! Et les femmes ? Et les esclaves ?",scores:{lumieres:2,histoire:0,ancien:0}},{text:"C'est joli, mais est-ce que √ßa fera baisser le prix du pain ?",scores:{lumieres:0,histoire:1,ancien:0}}]},
{id:6,acte:2,year:1789,title:"Les journ√©es d'octobre",icon:"üë©",text:"Octobre 1789. Le pain manque toujours √† Paris. Le 5 octobre, des milliers de femmes, arm√©es de piques et de b√¢tons, marchent sur Versailles aux cris de \"Du pain !\"\n\nLe lendemain, apr√®s une nuit agit√©e o√π la reine manque d'√™tre tu√©e, la famille royale est ramen√©e √† Paris. Le roi ne reviendra jamais √† Versailles.",question:"Que penses-tu de ces √©v√©nements ?",savoirPlus:"<h4>Le cort√®ge</h4><p>Les femmes ont \"ramen√© le boulanger, la boulang√®re et le petit mitron\" (le roi, la reine, le dauphin) !</p>",choices:[{text:"Le roi prisonnier de la populace ! Quelle humiliation !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Le roi doit vivre parmi son peuple, pas dans un palais dor√©.",scores:{lumieres:2,histoire:2,ancien:0}},{text:"Il aurait fallu pendre quelques aristocrates au passage !",scores:{lumieres:0,histoire:0,ancien:0}},{text:"Ces femmes avaient faim. Qui peut leur en vouloir ?",scores:{lumieres:1,histoire:1,ancien:0}}]},
{id:7,acte:2,year:1790,title:"La Constitution civile du clerg√©",icon:"‚õ™",text:"L'Assembl√©e r√©organise l'√âglise de France. Les <em>biens nationaux</em> (propri√©t√©s de l'√âglise) sont confisqu√©s et vendus. Les pr√™tres doivent pr√™ter serment de fid√©lit√© √† la Nation.\n\nLe clerg√© se divise : les \"jureurs\" acceptent, les \"r√©fractaires\" refusent. Le vieux cur√© de ton village a refus√© de jurer. Il est chass√©.",question:"Comment r√©agis-tu ?",savoirPlus:"<h4>La division</h4><p>Environ la moiti√© des pr√™tres refusent le serment. Cette division alimentera les guerres civiles.</p>",choices:[{text:"Ce pauvre cur√© ! Je l'aide √† se cacher.",scores:{lumieres:0,histoire:0,ancien:2}},{text:"La loi est la loi. L'√âglise doit servir la Nation.",scores:{lumieres:1,histoire:2,ancien:0}},{text:"Bon d√©barras ! Les cur√©s sont des parasites !",scores:{lumieres:0,histoire:0,ancien:0}},{text:"Je vais √† la messe du nouveau cur√©. Mieux vaut ne pas se faire remarquer.",scores:{lumieres:0,histoire:1,ancien:1}}]},
{id:8,acte:2,year:1790,title:"La F√™te de la F√©d√©ration",icon:"üéâ",text:"14 juillet 1790, premier anniversaire de la prise de la Bastille. 300 000 personnes se rassemblent au Champ-de-Mars pour c√©l√©brer l'unit√© de la France.\n\nLe roi Louis XVI pr√™te serment √† la Constitution devant la foule enthousiaste. C'est l'apog√©e de l'unit√© r√©volutionnaire. On croit √† la r√©conciliation !",question:"On te propose de participer √† cette f√™te historique.",savoirPlus:"<h4>L'illusion</h4><p>Ce moment d'union est trompeur. Dans quelques mois, le roi tentera de fuir...</p>",choices:[{text:"Voir le roi humili√©, oblig√© de pr√™ter serment ? Jamais !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"J'y vais avec enthousiasme ! C'est un jour historique !",scores:{lumieres:2,histoire:2,ancien:0}},{text:"J'y vais, mais je reste sceptique. Le roi n'est pas sinc√®re.",scores:{lumieres:1,histoire:1,ancien:0}},{text:"La f√™te, c'est joli, mais √ßa ne remplit pas les ventres.",scores:{lumieres:0,histoire:1,ancien:0}}]},
{id:9,acte:2,year:1791,title:"La fuite √† Varennes",icon:"üèÉ",text:"Nuit du 20 juin 1791. Louis XVI, d√©guis√© en valet, s'enfuit de Paris avec sa famille. Il esp√®re rejoindre les arm√©es autrichiennes pour reconqu√©rir son pouvoir absolu.\n\nMais √† Varennes, il est reconnu gr√¢ce √† son profil sur les pi√®ces de monnaie ! La famille royale est ramen√©e √† Paris dans un silence glacial.",question:"Pour beaucoup, c'est une trahison. Comment r√©agis-tu ?",savoirPlus:"<h4>Les cons√©quences</h4><p>Le mythe du \"roi p√®re de son peuple\" s'effondre. Les r√©publicains r√©clament sa d√©ch√©ance.</p>",choices:[{text:"Pauvre roi ! Prisonnier dans son propre pays !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"C'est une erreur, mais donnons-lui une seconde chance.",scores:{lumieres:1,histoire:2,ancien:0}},{text:"Le roi est un tra√Ætre ! √Ä mort le tyran !",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Attendons de voir... Peut-√™tre a-t-il √©t√© enlev√© ?",scores:{lumieres:0,histoire:1,ancien:1}}]},
{id:10,acte:2,year:1792,title:"La d√©claration de guerre",icon:"‚öîÔ∏è",text:"20 avril 1792. La France d√©clare la guerre √† l'Autriche. Les r√©volutionnaires veulent \"lib√©rer les peuples opprim√©s\". Le roi esp√®re secr√®tement une d√©faite qui restaurerait son pouvoir.\n\nC'est le d√©but de 23 ann√©es de guerres quasi-ininterrompues qui feront des millions de morts.",question:"Qu'en penses-tu ?",savoirPlus:"<h4>Robespierre contre la guerre</h4><p>\"Personne n'aime les missionnaires arm√©s.\" Il avait raison : la guerre m√®nera √† la dictature.</p>",choices:[{text:"Les arm√©es √©trang√®res vont r√©tablir le roi dans ses droits !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Cette guerre est juste : nous d√©fendons la libert√© des peuples !",scores:{lumieres:1,histoire:2,ancien:0}},{text:"Cette guerre est une folie qui va saigner le peuple !",scores:{lumieres:2,histoire:0,ancien:0}},{text:"Je m'engage comme volontaire pour d√©fendre la patrie !",scores:{lumieres:1,histoire:2,ancien:0}}]},
{id:11,acte:3,year:1792,title:"La chute de la royaut√©",icon:"üèõÔ∏è",text:"10 ao√ªt 1792. Les arm√©es ennemies avancent. Le manifeste de Brunswick menace Paris de destruction si on touche au roi.\n\nR√©ponse du peuple : les <em>sans-culottes</em> parisiens attaquent le palais des Tuileries. Les gardes suisses sont massacr√©s (600 morts). Louis XVI se r√©fugie √† l'Assembl√©e.\n\nLa monarchie, vieille de mille ans, s'effondre en quelques heures.",question:"Comment r√©agis-tu ?",savoirPlus:"<h4>Les sans-culottes</h4><p>Artisans et ouvriers parisiens. Ils portent le pantalon (pas la culotte des aristocrates) et le bonnet phrygien rouge.</p>",choices:[{text:"C'est la fin de tout ! Sans roi, la France est perdue !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"C'√©tait in√©vitable apr√®s Varennes. Place √† la R√©publique !",scores:{lumieres:2,histoire:2,ancien:0}},{text:"Victoire ! J'ai particip√© √† l'assaut !",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Attendons de voir qui prend le pouvoir...",scores:{lumieres:0,histoire:1,ancien:1}}]},
{id:12,acte:3,year:1792,title:"Les massacres de septembre",icon:"üíÄ",text:"Septembre 1792. Les Prussiens approchent de Paris. La panique s'empare de la ville. Pendant 5 jours, des bandes de sans-culottes envahissent les prisons et massacrent les d√©tenus : pr√™tres r√©fractaires, aristocrates, mais aussi voleurs et prostitu√©es.\n\n1 100 √† 1 400 morts. Les autorit√©s laissent faire.",question:"Comment r√©agis-tu ?",savoirPlus:"<h4>Le traumatisme</h4><p>Ces massacres divisent profond√©ment les r√©volutionnaires. Les Girondins accusent les Montagnards.</p>",choices:[{text:"Quelle horreur ! La R√©volution est devenue folle !",scores:{lumieres:2,histoire:0,ancien:1}},{text:"C'est terrible, mais la peur a rendu le peuple fou.",scores:{lumieres:1,histoire:2,ancien:0}},{text:"Ces aristocrates complotaient ! Le peuple a fait justice !",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Je reste enferm√© chez moi. Ne pas se faire remarquer.",scores:{lumieres:0,histoire:1,ancien:1}}]},
{id:13,acte:3,year:1793,title:"L'ex√©cution du roi",icon:"‚ö∞Ô∏è",text:"21 janvier 1793. Place de la R√©volution (actuelle Concorde). Louis XVI monte sur l'√©chafaud. Il tente de parler √† la foule mais les tambours couvrent sa voix.\n\n\"Je meurs innocent. Je pardonne √† mes ennemis.\"\n\nLa lame tombe. Un homme trempe son mouchoir dans le sang royal.",question:"Comment r√©agis-tu √† cette nouvelle ?",savoirPlus:"<h4>Le vote</h4><p>361 d√©put√©s ont vot√© la mort, 360 contre. Une seule voix de diff√©rence ! Philippe √âgalit√©, cousin du roi, a vot√© la mort.</p>",choices:[{text:"C'est un crime abominable ! Ils ont tu√© l'oint de Dieu !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"D√©cision terrible mais n√©cessaire. On ne pouvait pas le garder.",scores:{lumieres:1,histoire:2,ancien:0}},{text:"Mort au tyran ! Que tous les nobles suivent !",scores:{lumieres:0,histoire:1,ancien:0}},{text:"L'exil aurait suffi. Cela va nous attirer des ennemis.",scores:{lumieres:2,histoire:0,ancien:0}}]},
{id:14,acte:3,year:1793,title:"La Vend√©e se soul√®ve",icon:"üéñÔ∏è",text:"Mars 1793. La Convention ordonne la lev√©e de 300 000 hommes pour la guerre. En Vend√©e, les paysans refusent. Ils prennent les armes pour d√©fendre leurs pr√™tres r√©fractaires et leur mode de vie.\n\nUne guerre civile atroce commence entre \"Blancs\" (royalistes) et \"Bleus\" (r√©publicains). Entre 150 000 et 300 000 morts.",question:"Comment juges-tu cette r√©volte ?",savoirPlus:"<h4>Pourquoi la Vend√©e ?</h4><p>R√©gion tr√®s catholique, attach√©e √† ses pr√™tres. Les paysans ne veulent pas mourir pour une r√©volution qu'ils n'ont pas choisie.</p>",choices:[{text:"Ces Vend√©ens sont des h√©ros qui d√©fendent la vraie foi !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Je comprends leur attachement religieux, mais la patrie est en danger.",scores:{lumieres:1,histoire:2,ancien:0}},{text:"Ce sont des tra√Ætres vendus aux Anglais ! Il faut les √©craser !",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Ouf, je n'ai pas √©t√© tir√© au sort pour la guerre...",scores:{lumieres:0,histoire:1,ancien:0}}]},
{id:15,acte:3,year:1793,title:"L'assassinat de Marat",icon:"üó°Ô∏è",text:"13 juillet 1793. Charlotte Corday, une jeune Normande de 24 ans, poignarde Jean-Paul Marat dans sa baignoire. \"L'Ami du peuple\", journaliste radical, r√©clamait toujours plus de t√™tes.\n\n\"J'ai tu√© un homme pour en sauver cent mille\", dit-elle √† son proc√®s.\n\nElle est guillotin√©e 4 jours plus tard. Marat devient un martyr, la Terreur s'intensifie.",question:"Comment r√©agis-tu ?",savoirPlus:"<h4>Le tableau de David</h4><p>Le peintre Jacques-Louis David immortalise la sc√®ne. Marat devient un saint r√©volutionnaire.</p>",choices:[{text:"Cette femme est une h√©ro√Øne courageuse !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"L'assassinat politique est condamnable, mais Marat appelait au meurtre...",scores:{lumieres:2,histoire:1,ancien:0}},{text:"Marat √©tait l'ami du peuple ! Vengeance !",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Je garde mes opinions pour moi. C'est plus prudent.",scores:{lumieres:0,histoire:2,ancien:1}}]},
{id:16,acte:3,year:1793,title:"La Terreur",icon:"üîí",text:"La <em>Terreur</em> est \"√† l'ordre du jour\". Le Comit√© de salut public gouverne par d√©crets. La loi des suspects permet d'arr√™ter n'importe qui. Le Tribunal r√©volutionnaire juge sans appel.\n\nLa <em>guillotine</em> fonctionne tous les jours. 17 000 ex√©cutions officielles (bien plus en r√©alit√©). On peut mourir pour une parole, un geste, une ancienne amiti√©.",question:"Comment survis-tu √† cette p√©riode ?",savoirPlus:"<h4>Qui meurt ?</h4><p>Nobles, pr√™tres, mais surtout des gens ordinaires : 85% des guillotin√©s sont des roturiers.</p>",choices:[{text:"Je prie en secret pour que ce cauchemar finisse.",scores:{lumieres:1,histoire:0,ancien:2}},{text:"C'est horrible, mais n√©cessaire pour sauver la R√©publique.",scores:{lumieres:0,histoire:2,ancien:0}},{text:"Je d√©nonce un voisin suspect au Comit√© de surveillance.",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Je reste discret, je travaille, je ne parle √† personne.",scores:{lumieres:1,histoire:2,ancien:1}}]},
{id:17,acte:3,year:1794,title:"La chute de Robespierre",icon:"‚ö°",text:"9 <em>Thermidor</em> an II (27 juillet 1794). Robespierre, \"l'Incorruptible\", est arr√™t√© par la Convention. Lui qui a envoy√© tant de gens √† la mort est guillotin√© le lendemain avec 21 de ses partisans.\n\nLa Terreur prend fin. On respire enfin. Mais qui a vraiment gagn√© ?",question:"Comment r√©agis-tu √† la chute de Robespierre ?",savoirPlus:"<h4>Apr√®s Thermidor</h4><p>La \"r√©action thermidorienne\" : on poursuit les anciens terroristes, on ferme les clubs, on r√®gle ses comptes.</p>",choices:[{text:"Enfin ! Le tyran est mort ! Vive le roi !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"La Terreur √©tait devenue folle. Tant mieux que ce soit fini.",scores:{lumieres:2,histoire:2,ancien:0}},{text:"Robespierre d√©fendait le peuple ! Ce sont les corrompus qui l'ont abattu !",scores:{lumieres:1,histoire:0,ancien:0}},{text:"Ouf ! On va peut-√™tre pouvoir respirer...",scores:{lumieres:1,histoire:2,ancien:0}}]},
{id:18,acte:4,year:1795,title:"Le Directoire",icon:"üèõÔ∏è",text:"Le <em>Directoire</em> remplace la Convention. Cinq directeurs gouvernent la France. C'est un r√©gime bourgeois, mod√©r√©, mais instable et corrompu.\n\nLes sans-culottes sont √©cart√©s du pouvoir. Les royalistes rel√®vent la t√™te. La guerre continue.",question:"Que penses-tu de ce nouveau r√©gime ?",savoirPlus:"<h4>Un r√©gime faible</h4><p>4 coups d'√âtat en 4 ans. Ni royaliste ni jacobin, le Directoire ne satisfait personne.</p>",choices:[{text:"Sans roi, la France ne peut que sombrer dans le chaos.",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Au moins, la Terreur est finie. Laissons-leur une chance.",scores:{lumieres:1,histoire:2,ancien:0}},{text:"Ces bourgeois corrompus ont trahi la R√©volution du peuple !",scores:{lumieres:2,histoire:0,ancien:0}},{text:"Peu importe qui gouverne, tant qu'on peut faire des affaires.",scores:{lumieres:0,histoire:1,ancien:0}}]},
{id:19,acte:4,year:1796,title:"Bonaparte en Italie",icon:"‚öîÔ∏è",text:"Un jeune g√©n√©ral corse de 27 ans, Napol√©on Bonaparte, prend le commandement de l'arm√©e d'Italie. En quelques mois, il remporte victoire sur victoire contre les Autrichiens.\n\nIl impose la paix, cr√©e des r√©publiques-s≈ìurs, ram√®ne des tr√©sors artistiques. Il devient un h√©ros national.",question:"Que penses-tu de ce g√©n√©ral victorieux ?",savoirPlus:"<h4>L'art de la propagande</h4><p>Bonaparte √©crit lui-m√™me les bulletins de victoire. Il soigne son image aupr√®s de l'opinion.</p>",choices:[{text:"Un militaire qui prend trop de pouvoir est dangereux pour la libert√©.",scores:{lumieres:2,histoire:0,ancien:0}},{text:"Enfin un homme fort ! La France a besoin de victoires !",scores:{lumieres:0,histoire:2,ancien:1}},{text:"Ce g√©n√©ral va peut-√™tre restaurer l'ordre et la monarchie.",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Les victoires, c'est bien, mais quand aurons-nous enfin la paix ?",scores:{lumieres:1,histoire:1,ancien:0}}]},
{id:20,acte:4,year:1799,title:"Le coup d'√âtat du 18 Brumaire",icon:"üé≠",text:"9 novembre 1799 (<em>18 Brumaire</em> an VIII). Bonaparte renverse le Directoire avec l'aide de son fr√®re et de quelques complices. Les d√©put√©s sont dispers√©s par les soldats.\n\n\"Citoyens, la R√©volution est fix√©e aux principes qui l'ont commenc√©e : elle est finie.\"\n\nBonaparte devient Premier Consul. Il concentre tous les pouvoirs.",question:"Comment r√©agis-tu √† ce coup de force ?",savoirPlus:"<h4>La fin de la R√©publique ?</h4><p>En apparence, la R√©publique continue. En r√©alit√©, c'est une dictature militaire.</p>",choices:[{text:"Un dictateur militaire ! C'est la mort de la libert√© !",scores:{lumieres:2,histoire:0,ancien:0}},{text:"Enfin un homme fort pour mettre fin au chaos !",scores:{lumieres:0,histoire:2,ancien:1}},{text:"Peut-√™tre va-t-il restaurer le roi ?",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Attendons de voir ce qu'il fait avant de juger.",scores:{lumieres:1,histoire:2,ancien:0}}]},
{id:21,acte:5,year:1801,title:"Le Concordat",icon:"‚õ™",text:"Bonaparte signe le <em>Concordat</em> avec le pape Pie VII. La paix religieuse revient en France apr√®s 10 ans de conflit.\n\nLe catholicisme n'est plus religion d'√âtat, mais \"religion de la majorit√© des Fran√ßais\". L'√âtat paie les pr√™tres, mais garde les biens nationaux.",question:"Que penses-tu de cette r√©conciliation avec l'√âglise ?",savoirPlus:"<h4>Un compromis</h4><p>Les r√©volutionnaires sont furieux. Les catholiques sont soulag√©s. Bonaparte a pacifi√© une guerre civile latente.</p>",choices:[{text:"Dieu soit lou√© ! On peut enfin pratiquer librement !",scores:{lumieres:0,histoire:1,ancien:2}},{text:"C'est un compromis intelligent qui apaise les divisions.",scores:{lumieres:1,histoire:2,ancien:0}},{text:"Bonaparte trahit la R√©volution en s'alliant aux pr√™tres !",scores:{lumieres:2,histoire:0,ancien:0}},{text:"Tant qu'on ne m'oblige pas √† aller √† la messe...",scores:{lumieres:1,histoire:1,ancien:0}}]},
{id:22,acte:5,year:1804,title:"Le sacre de Napol√©on",icon:"üëë",text:"2 d√©cembre 1804. √Ä Notre-Dame de Paris, Napol√©on Bonaparte se couronne lui-m√™me empereur des Fran√ßais. Le pape est pr√©sent, mais Napol√©on saisit la couronne et la pose lui-m√™me sur sa t√™te.\n\nMessage clair : il ne doit son pouvoir qu'√† lui-m√™me, pas √† Dieu ni au peuple.",question:"Comment r√©agis-tu ?",savoirPlus:"<h4>Le Code civil</h4><p>La m√™me ann√©e, Napol√©on promulgue le Code civil : √©galit√© devant la loi, libert√© de conscience, droit de propri√©t√©. Encore en vigueur aujourd'hui !</p>",choices:[{text:"Un usurpateur ! Le vrai roi l√©gitime est Louis XVIII !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Empereur... La R√©publique est bien morte. Triste jour.",scores:{lumieres:2,histoire:1,ancien:0}},{text:"Vive l'Empereur ! Il incarne la gloire de la France !",scores:{lumieres:0,histoire:2,ancien:0}},{text:"Roi ou empereur, quelle diff√©rence ? Tant qu'il y a l'ordre.",scores:{lumieres:0,histoire:1,ancien:1}}]},
{id:23,acte:5,year:1805,title:"Austerlitz",icon:"‚öîÔ∏è",text:"2 d√©cembre 1805, anniversaire du sacre. Napol√©on √©crase les arm√©es autrichiennes et russes √† Austerlitz, en Moravie.\n\nC'est le \"soleil d'Austerlitz\", sa plus belle victoire. Napol√©on a feint la faiblesse pour attirer l'ennemi dans un pi√®ge. 15 000 morts c√¥t√© ennemi, 1 300 c√¥t√© fran√ßais.",question:"Comment r√©agis-tu √† cette victoire ?",savoirPlus:"<h4>La Grande Arm√©e</h4><p>Napol√©on commande la meilleure arm√©e d'Europe, forg√©e par 15 ans de guerre. Ses mar√©chaux sont des l√©gendes.</p>",choices:[{text:"Ces victoires ne profitent qu'√† l'ambition d'un seul homme.",scores:{lumieres:2,histoire:0,ancien:1}},{text:"Gloire √† l'Empereur ! La France domine l'Europe !",scores:{lumieres:0,histoire:2,ancien:0}},{text:"Mon fils est mort l√†-bas. Maudite soit cette guerre.",scores:{lumieres:1,histoire:0,ancien:0}},{text:"Tant de victoires... mais quand aurons-nous enfin la paix ?",scores:{lumieres:2,histoire:1,ancien:0}}]},
{id:24,acte:5,year:1806,title:"Le blocus continental",icon:"üö¢",text:"Napol√©on d√©cr√®te le <em>blocus continental</em> : interdiction totale de commercer avec l'Angleterre. Il veut asphyxier √©conomiquement son dernier ennemi.\n\nMais le blocus ruine les ports fran√ßais et fait monter les prix. La contrebande se d√©veloppe.",question:"Comment cette mesure t'affecte-t-elle ?",savoirPlus:"<h4>Cons√©quences inattendues</h4><p>Le blocus d√©veloppe l'industrie sucri√®re (betterave au lieu de canne) et textile fran√ßaise. Mais il cr√©e aussi du m√©contentement.</p>",choices:[{text:"L'Empereur sait ce qu'il fait. Il faut vaincre l'Angleterre.",scores:{lumieres:0,histoire:2,ancien:0}},{text:"Mon commerce est ruin√© ! C'est une politique absurde !",scores:{lumieres:1,histoire:0,ancien:1}},{text:"Je fais de la contrebande avec l'Angleterre. Il faut bien vivre.",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Je me reconvertis dans la betterave sucri√®re.",scores:{lumieres:0,histoire:2,ancien:0}}]},
{id:25,acte:5,year:1812,title:"La campagne de Russie",icon:"‚ùÑÔ∏è",text:"Napol√©on envahit la Russie avec la Grande Arm√©e : 600 000 hommes, la plus grande arm√©e jamais assembl√©e en Europe.\n\nMais les Russes refusent le combat et pratiquent la terre br√ªl√©e. Moscou est prise, mais incendi√©e. La retraite dans le froid et la neige est un d√©sastre.\n\nMoins de 100 000 hommes en reviendront.",question:"Comment r√©agis-tu √† cette catastrophe ?",savoirPlus:"<h4>La B√©r√©zina</h4><p>Le passage de cette rivi√®re glac√©e, sous le feu des Russes, devient synonyme de d√©sastre total.</p>",choices:[{text:"L'orgueil d√©mesur√© de Napol√©on a caus√© la mort de nos fils.",scores:{lumieres:2,histoire:1,ancien:1}},{text:"L'Empereur a √©t√© trahi par le froid et les g√©n√©raux.",scores:{lumieres:0,histoire:1,ancien:0}},{text:"C'est la fin. La France ne s'en remettra pas.",scores:{lumieres:1,histoire:2,ancien:1}},{text:"Mon fr√®re n'est pas revenu. Je maudis cette guerre.",scores:{lumieres:2,histoire:1,ancien:0}}]},
{id:26,acte:5,year:1814,title:"L'abdication",icon:"üìú",text:"Les arm√©es coalis√©es (Russie, Prusse, Autriche, Angleterre) envahissent la France. Paris tombe le 31 mars 1814.\n\nNapol√©on abdique le 6 avril. Il re√ßoit la souverainet√© de l'√Æle d'Elbe, en M√©diterran√©e.\n\nLouis XVIII, fr√®re de Louis XVI, rentre √† Paris. Les Bourbons sont de retour.",question:"Comment r√©agis-tu au retour des Bourbons ?",savoirPlus:"<h4>La Charte</h4><p>Louis XVIII accorde une Constitution (la \"Charte\"). La monarchie absolue ne reviendra pas.</p>",choices:[{text:"Enfin ! Le roi l√©gitime est de retour !",scores:{lumieres:0,histoire:1,ancien:2}},{text:"Adieu la R√©publique, adieu l'Empire... Tout √ßa pour √ßa.",scores:{lumieres:2,histoire:1,ancien:0}},{text:"Napol√©on reviendra. Ce n'est qu'un au revoir.",scores:{lumieres:0,histoire:2,ancien:0}},{text:"Un roi, un empereur... Je veux juste la paix.",scores:{lumieres:1,histoire:1,ancien:0}}]},
{id:27,acte:6,year:1815,title:"Les Cent-Jours",icon:"ü¶Ö",text:"Mars 1815. Napol√©on s'√©vade de l'√Æle d'Elbe avec 1 000 hommes. Il d√©barque sur la C√¥te d'Azur et marche vers Paris.\n\nLes soldats envoy√©s l'arr√™ter se rallient √† lui. \"L'aigle volera de clocher en clocher jusqu'aux tours de Notre-Dame.\"\n\nLouis XVIII fuit. Napol√©on reprend le pouvoir pour Cent Jours.",question:"Comment r√©agis-tu √† ce retour spectaculaire ?",savoirPlus:"<h4>Le vol de l'Aigle</h4><p>Napol√©on reconquiert la France sans tirer un coup de feu. Son charisme est intact.</p>",choices:[{text:"L'usurpateur est de retour ! Fuyons !",scores:{lumieres:0,histoire:0,ancien:2}},{text:"Vive l'Empereur ! Il va nous venger !",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Encore la guerre... Combien de morts cette fois ?",scores:{lumieres:2,histoire:1,ancien:0}},{text:"Attendons de voir qui l'emporte avant de choisir.",scores:{lumieres:0,histoire:2,ancien:1}}]},
{id:28,acte:6,year:1815,title:"Waterloo",icon:"‚öîÔ∏è",text:"18 juin 1815. <em>Waterloo</em>, en Belgique. Napol√©on affronte les Anglais de Wellington et les Prussiens de Bl√ºcher.\n\nLa bataille est longue et ind√©cise. L'arriv√©e des Prussiens en fin de journ√©e scelle le sort de l'Empire. C'est la d√©faite finale.\n\n\"Morne plaine\" √©crira Victor Hugo. 50 000 morts en une journ√©e.",question:"C'est vraiment la fin cette fois. Comment te sens-tu ?",savoirPlus:"<h4>L'exil final</h4><p>Napol√©on se rend aux Anglais. Il sera exil√© √† Sainte-H√©l√®ne, √Æle perdue dans l'Atlantique Sud.</p>",choices:[{text:"Justice divine ! Le tyran est enfin vaincu !",scores:{lumieres:0,histoire:1,ancien:2}},{text:"La France a perdu sa gloire. Tout est fini.",scores:{lumieres:0,histoire:1,ancien:0}},{text:"Enfin la paix ! Qu'on nous laisse vivre en paix !",scores:{lumieres:2,histoire:2,ancien:0}},{text:"Napol√©on √©tait un g√©nie. L'histoire le reconna√Ætra.",scores:{lumieres:0,histoire:1,ancien:0}}]},
{id:29,acte:6,year:1821,title:"Mort de Napol√©on",icon:"‚ö∞Ô∏è",text:"5 mai 1821. Napol√©on Bonaparte meurt √† <em>Sainte-H√©l√®ne</em>, apr√®s 6 ans d'exil. Il a 51 ans.\n\nSes derniers mots auraient √©t√© : \"France... arm√©e... t√™te d'arm√©e... Jos√©phine...\"\n\nSon corps sera ramen√© √† Paris en 1840, aux Invalides, o√π il repose encore aujourd'hui.",question:"32 ans ont pass√© depuis 1789. Quel bilan tires-tu de cette √©poque tumultueuse ?",savoirPlus:"<h4>L'h√©ritage</h4><p>Le Code civil, le syst√®me √©ducatif, l'administration moderne, le syst√®me m√©trique... Napol√©on a fa√ßonn√© la France moderne.</p>",choices:[{text:"Bon d√©barras ! Cet homme a caus√© des millions de morts.",scores:{lumieres:1,histoire:0,ancien:2}},{text:"Un g√©ant de l'Histoire. La France ne sera plus jamais la m√™me.",scores:{lumieres:0,histoire:2,ancien:0}},{text:"Il a trahi les id√©aux de la R√©volution pour son ambition personnelle.",scores:{lumieres:2,histoire:1,ancien:0}},{text:"L'Histoire jugera. Nous sommes encore trop proches pour comprendre.",scores:{lumieres:2,histoire:2,ancien:0}}]}
];

function generateGameCode() { const c='ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; let r=''; for(let i=0;i<4;i++)r+=c.charAt(Math.floor(Math.random()*c.length)); return r; }

document.getElementById('createGameBtn').addEventListener('click', async function() {
    gameCode = generateGameCode();
    gameRef = database.ref('games/' + gameCode);
    await gameRef.set({ status: 'waiting', currentSituation: 0, createdAt: Date.now(), players: {} });
    document.getElementById('createSection').classList.add('hidden');
    document.getElementById('waitingSection').classList.remove('hidden');
    document.getElementById('displayCode').textContent = gameCode;
    const joinUrl = window.location.href.replace('maitre', 'eleve').split('?')[0] + '?code=' + gameCode;
    document.getElementById('joinUrl').textContent = joinUrl;
    const qrContainer = document.getElementById('qrCode');
    qrContainer.innerHTML = '';
    new QRCode(qrContainer, { text: joinUrl, width: 180, height: 180, colorDark: '#002654', colorLight: '#ffffff' });
    gameRef.child('players').on('value', (snapshot) => { players = snapshot.val() || {}; updatePlayersList(); });
});

function updatePlayersList() {
    const container = document.getElementById('playersWaiting');
    const names = Object.values(players).map(p => p.name).filter(n => n);
    container.innerHTML = names.map(n => '<span class="player-chip">' + n + '</span>').join('');
    document.getElementById('playerCountSetup').textContent = names.length;
    document.getElementById('startGameBtn').disabled = names.length < 1;
}

document.getElementById('startGameBtn').addEventListener('click', async function() {
    await gameRef.update({ status: 'playing', currentSituation: 0 });
    document.getElementById('setupScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    document.getElementById('headerCode').textContent = gameCode;
    document.getElementById('totalNum').textContent = situations.length;
    renderSituation();
    listenToResponses();
});

function addTooltips(text) {
    return text.replace(/<em>([^<]+)<\/em>/g, function(m, t) {
        return '<span class="term">' + t + '</span>';
    });
}

function renderSituation() {
    showingRankings = false;
    document.getElementById('situationScreen').style.display = 'flex';
    document.getElementById('rankingsScreen').classList.remove('active');
    
    const s = situations[currentSituation];
    const a = actes.find(x => x.id === s.acte);
    document.getElementById('situationYear').textContent = s.year;
    document.getElementById('situationActe').textContent = 'Acte ' + a.id + ' ‚Ä¢ ' + a.periode;
    document.getElementById('situationIcon').textContent = s.icon;
    document.getElementById('situationTitle').textContent = s.title;
    document.getElementById('situationText').innerHTML = addTooltips(s.text).replace(/\n/g, '<br><br>');
    document.getElementById('situationQuestion').textContent = s.question;
    document.getElementById('currentNum').textContent = currentSituation + 1;
    
    const cl = document.getElementById('choicesList');
    cl.innerHTML = '';
    ['A','B','C','D'].forEach((l, i) => {
        if (s.choices[i]) {
            const d = document.createElement('div');
            d.className = 'choice-item';
            d.innerHTML = '<span class="choice-letter">' + l + '</span><span>' + s.choices[i].text + '</span>';
            cl.appendChild(d);
        }
    });
    
    document.getElementById('nextBtn').disabled = true;
    document.getElementById('nextBtn').textContent = 'En attente des r√©ponses...';
    if (gameRef) gameRef.update({ currentSituation });
}

function showRankings() {
    showingRankings = true;
    document.getElementById('situationScreen').style.display = 'none';
    document.getElementById('rankingsScreen').classList.add('active');
    document.getElementById('nextBtn').disabled = false;
    document.getElementById('nextBtn').textContent = currentSituation < situations.length - 1 ? 'Situation suivante ‚Üí' : 'Voir les r√©sultats ‚Üí';
    updateRankings();
}

function listenToResponses() {
    gameRef.child('players').on('value', (snapshot) => {
        players = snapshot.val() || {};
        let resp = 0;
        Object.values(players).forEach(p => { if (p.responses && p.responses[currentSituation] !== undefined) resp++; });
        const total = Object.keys(players).length;
        document.getElementById('responsesCount').textContent = resp;
        document.getElementById('totalPlayers').textContent = total;
        
        if (resp >= total && total > 0 && !showingRankings) {
            showRankings();
        }
        
        updateRankings();
    });
}

function updateRankings() {
    const scores = [];
    Object.entries(players).forEach(([id, p]) => {
        let l = 0, h = 0, a = 0;
        if (p.responses) {
            Object.entries(p.responses).forEach(([si, ci]) => {
                const sit = situations[parseInt(si)];
                if (sit && sit.choices[ci]) { l += sit.choices[ci].scores.lumieres || 0; h += sit.choices[ci].scores.histoire || 0; a += sit.choices[ci].scores.ancien || 0; }
            });
        }
        scores.push({ name: p.name, lumieres: l, histoire: h, ancien: a });
    });
    renderRanking('rankingLumieres', scores.slice().sort((a, b) => b.lumieres - a.lumieres), 'lumieres');
    renderRanking('rankingHistoire', scores.slice().sort((a, b) => b.histoire - a.histoire), 'histoire');
    renderRanking('rankingAncien', scores.slice().sort((a, b) => b.ancien - a.ancien), 'ancien');
}

function renderRanking(id, sorted, key) {
    const c = document.getElementById(id);
    c.innerHTML = '';
    sorted.forEach((p, i) => {
        const li = document.createElement('li');
        li.className = 'ranking-item';
        li.innerHTML = '<span class="ranking-position">' + (i + 1) + '</span><span class="ranking-name">' + p.name + '</span><span class="ranking-score">' + p[key] + ' pts</span>';
        c.appendChild(li);
    });
}

document.getElementById('nextBtn').addEventListener('click', function() {
    if (currentSituation < situations.length - 1) {
        currentSituation++;
        renderSituation();
    } else {
        showEndScreen();
    }
});

function showEndScreen() {
    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('endScreen').classList.add('active');
    
    const scores = [];
    Object.entries(players).forEach(([id, p]) => {
        let l = 0, h = 0, a = 0;
        if (p.responses) { Object.entries(p.responses).forEach(([si, ci]) => { const sit = situations[parseInt(si)]; if (sit && sit.choices[ci]) { l += sit.choices[ci].scores.lumieres || 0; h += sit.choices[ci].scores.histoire || 0; a += sit.choices[ci].scores.ancien || 0; } }); }
        scores.push({ name: p.name, lumieres: l, histoire: h, ancien: a });
    });
    
    const lTop = scores.slice().sort((a, b) => b.lumieres - a.lumieres);
    const hTop = scores.slice().sort((a, b) => b.histoire - a.histoire);
    const aTop = scores.slice().sort((a, b) => b.ancien - a.ancien);
    const avgL = scores.reduce((s, p) => s + p.lumieres, 0) / scores.length || 0;
    const avgH = scores.reduce((s, p) => s + p.histoire, 0) / scores.length || 0;
    const avgA = scores.reduce((s, p) => s + p.ancien, 0) / scores.length || 0;
    
    let tendency = avgH > avgL && avgH > avgA ? "üéØ Votre classe aurait suivi le cours de l'Histoire, s'adaptant aux √©v√©nements." : avgL > avgH && avgL > avgA ? "üèõÔ∏è Votre classe est fid√®le aux id√©aux des Lumi√®res : libert√©, √©galit√©, raison." : "üëë Votre classe aurait d√©fendu l'ordre traditionnel et la monarchie.";
    
    document.getElementById('endScreen').innerHTML = '<h1 class="end-title">üèõÔ∏è Fin de la partie !</h1><div class="final-rankings"><div class="final-ranking-card lumieres"><div class="ranking-header"><span class="ranking-icon">üèõÔ∏è</span><span class="ranking-title">Penseurs des Lumi√®res</span></div><div class="podium">' + (lTop[1] ? '<div class="podium-place second"><div class="podium-name">' + lTop[1].name + '</div><div class="podium-score">' + lTop[1].lumieres + ' pts</div></div>' : '') + (lTop[0] ? '<div class="podium-place first"><div class="podium-name">' + lTop[0].name + '</div><div class="podium-score">' + lTop[0].lumieres + ' pts</div></div>' : '') + (lTop[2] ? '<div class="podium-place third"><div class="podium-name">' + lTop[2].name + '</div><div class="podium-score">' + lTop[2].lumieres + ' pts</div></div>' : '') + '</div></div><div class="final-ranking-card histoire"><div class="ranking-header"><span class="ranking-icon">üìú</span><span class="ranking-title">Acteurs de l\'Histoire</span></div><div class="podium">' + (hTop[1] ? '<div class="podium-place second"><div class="podium-name">' + hTop[1].name + '</div><div class="podium-score">' + hTop[1].histoire + ' pts</div></div>' : '') + (hTop[0] ? '<div class="podium-place first"><div class="podium-name">' + hTop[0].name + '</div><div class="podium-score">' + hTop[0].histoire + ' pts</div></div>' : '') + (hTop[2] ? '<div class="podium-place third"><div class="podium-name">' + hTop[2].name + '</div><div class="podium-score">' + hTop[2].histoire + ' pts</div></div>' : '') + '</div></div><div class="final-ranking-card ancien"><div class="ranking-header"><span class="ranking-icon">üëë</span><span class="ranking-title">D√©fenseurs Ancien R√©gime</span></div><div class="podium">' + (aTop[1] ? '<div class="podium-place second"><div class="podium-name">' + aTop[1].name + '</div><div class="podium-score">' + aTop[1].ancien + ' pts</div></div>' : '') + (aTop[0] ? '<div class="podium-place first"><div class="podium-name">' + aTop[0].name + '</div><div class="podium-score">' + aTop[0].ancien + ' pts</div></div>' : '') + (aTop[2] ? '<div class="podium-place third"><div class="podium-name">' + aTop[2].name + '</div><div class="podium-score">' + aTop[2].ancien + ' pts</div></div>' : '') + '</div></div></div><div class="class-stats"><h2 class="stats-title">üìä Tendance de la classe</h2><div class="stats-grid"><div class="stat-item"><div class="stat-value">' + scores.length + '</div><div class="stat-label">Joueurs</div></div><div class="stat-item"><div class="stat-value">' + avgL.toFixed(1) + '</div><div class="stat-label">Moy. Lumi√®res</div></div><div class="stat-item"><div class="stat-value">' + avgH.toFixed(1) + '</div><div class="stat-label">Moy. Histoire</div></div><div class="stat-item"><div class="stat-value">' + avgA.toFixed(1) + '</div><div class="stat-label">Moy. Ancien R√©gime</div></div></div><p style="text-align:center;margin-top:1.5rem;font-size:1.2rem;">' + tendency + '</p></div><div style="text-align:center;margin-top:2rem;"><button class="btn btn-gold" onclick="location.reload()" style="font-size:1.2rem;padding:1rem 3rem;">Nouvelle partie</button></div>';
}
</script>
</body>
</html>
